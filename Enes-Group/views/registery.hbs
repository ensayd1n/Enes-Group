<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet"> 
  <title>Register</title>
</head>
<body class="flex items-center justify-end min-h-screen" style="background-image: url('registery-background.png'); background-size: cover; background-position: center; padding-right: 400px;">

  <div class="bg-white p-8 rounded-lg shadow-lg w-80">
    <form id="registerForm" class="form">
      <h2 class="text-2xl font-semibold mb-1 text-center text-gray-600 font-bold">REGISTERY</h2>
      <div class="mb-2">
        <label for="firstName" class="block text-gray-600 text-sm font-bold">First Name:</label>
        <input type="text" id="firstName" name="firstName" class="bg-white rounded-lg w-full py-1.5 px-2 text-gray-700 shadow-md focus:outline-none focus:ring focus:ring-gray-200 focus:bg-gray-200" required>
        <div id="nameToolTip" class="hidden absolute top-full left-0 mt-2 z-10 w-64"> 
          <div class="bg-gray-100 border border-gray-300 rounded-lg p-4 shadow-md">
            <div class="border-b border-gray-300 pb-2 mb-2 font-semibold">Name Rules</div>
            <ul class="list-disc pl-5 text-sm text-gray-600">
              <li>Must be at least 2 characters long.</li>
              <li>Must not contain numbers.</li>
              <li>Must contain at least one letter.</li>
              <li>Cannot contain special characters (e.g., !@#$%^&*).</li>
              <li>Must not contain spaces.</li>
            </ul>
          </div>
          <div class="absolute top-0 left-1/2 -ml-2 w-4 h-4 bg-gray-100 transform rotate-45 border-t border-l border-gray-300"></div> 
        </div>
      </div>
      <div class="mb-2">
        <label for="lastName" class="block text-gray-600 text-sm font-bold">Last Name:</label>
        <input type="text" id="lastName" name="lastName" class="bg-white rounded-lg w-full py-1.5 px-2 text-gray-700 shadow-md focus:outline-none focus:ring focus:ring-gray-200 focus:bg-gray-200" required>
        <div id="lastNameToolTip" class="hidden absolute top-full left-0 mt-2 z-10 w-64"> 
          <div class="bg-gray-100 border border-gray-300 rounded-lg p-4 shadow-md">
            <div class="border-b border-gray-300 pb-2 mb-2 font-semibold">Last Name Rules</div>
            <ul class="list-disc pl-5 text-sm text-gray-600">
              <li>Must be at least 2 characters long.</li>
              <li>Must not contain numbers.</li>
              <li>Must contain at least one letter.</li>
              <li>Cannot contain special characters (e.g., !@#$%^&*).</li>
              <li>Must not contain spaces.</li>
            </ul>
          </div>
          <div class="absolute top-0 left-1/2 -ml-2 w-4 h-4 bg-gray-100 transform rotate-45 border-t border-l border-gray-300"></div> 
        </div>
      </div>
      <div class="mb-2">
        <label for="birthdate" class="block text-gray-600 text-sm font-bold">Birthdate:</label>
        <input type="date" id="birthdate" name="birthdate" class="bg-white rounded-lg w-full py-1.5 px-2 text-gray-700 shadow-md focus:outline-none focus:ring focus:ring-gray-200 focus:bg-gray-200" required>
        <div id="birthdateToolTip" class="hidden absolute top-full left-0 mt-2 z-10 w-64"> 
          <div class="bg-gray-100 border border-gray-300 rounded-lg p-4 shadow-md">
            <div class="border-b border-gray-300 pb-2 mb-2 font-semibold">Birthday Rules</div>
            <ul class="list-disc pl-5 text-sm text-gray-600">
              <li>Persons under the age of 18 cannot register.</li>
            </ul>
          </div>
          <div class="absolute top-0 left-1/2 -ml-2 w-4 h-4 bg-gray-100 transform rotate-45 border-t border-l border-gray-300"></div> 
        </div>
      </div>
      <div class="mb-2">
        <label for="email" class="block text-gray-600 text-sm font-bold">Email:</label>
        <input type="email" id="email" name="email" class="bg-white rounded-lg w-full py-1.5 px-2 text-gray-700 shadow-md focus:outline-none focus:ring focus:ring-gray-200 focus:bg-gray-200" required>
      </div>
      <div class="mb-2 relative"> 
        <label for="password" class="block text-gray-600 text-sm font-bold">Password:</label>
        <input type="password" id="password" name="password" class="bg-white rounded-lg w-full py-1.5 px-2 text-gray-700 shadow-md focus:outline-none focus:ring focus:ring-gray-200 focus:bg-gray-200" required>
        <div id="passwordTooltip" class="hidden absolute top-full left-0 mt-2 z-10 w-64"> 
          <div class="bg-gray-100 border border-gray-300 rounded-lg p-4 shadow-md">
            <div class="border-b border-gray-300 pb-2 mb-2 font-semibold">Password Rules</div>
            <ul class="list-disc pl-5 text-sm text-gray-600">
              <li>Must be at least 6 characters long.</li>
              <li>Must contain at least one digit.</li>
              <li>Must contain at least one letter.</li>
              <li>Must contain at least one special character (e.g., !@#$%^&*).</li>
              <li>Must not contain spaces.</li>
            </ul>
          </div>
          <div class="absolute top-0 left-1/2 -ml-2 w-4 h-4 bg-gray-100 transform rotate-45 border-t border-l border-gray-300"></div> 
        </div>
      </div>
      <div class="mb-4 relative"> 
        <label for="confirmPassword" class="block text-gray-600 text-sm font-bold">Confirm Password:</label>
        <input type="password" id="confirmPassword" name="confirmPassword" class="bg-white rounded-lg w-full py-1.5 px-2 text-gray-700 shadow-md focus:outline-none focus:ring focus:ring-gray-200 focus:bg-gray-200" required>
        <div id="confirmPasswordTooltip" class="hidden absolute top-full left-0 mt-2 z-10 w-64"> 
          <div class="bg-gray-100 border border-gray-300 rounded-lg p-4 shadow-md">
            <div class="border-b border-gray-300 pb-2 mb-2 font-semibold">Confirm Password Rules</div>
            <ul class="list-disc pl-5 text-sm text-gray-600">
              <li>It must match the first password you entered.</li>
            </ul>
          </div>
          <div class="absolute top-0 left-1/2 -ml-2 w-4 h-4 bg-gray-100 transform rotate-45 border-t border-l border-gray-300"></div> 
        </div>
      </div>
      <button type="submit" class="bg-yellow-300 hover:bg-yellow-400 text-white font-semibold py-2 px-4 rounded-lg focus:outline-none w-full text-shadow">
        Register
      </button>
    </form>
     <form id="registerForm2" class="form hidden">
    <h2 class="text-2xl font-semibold mb-4 text-center text-gray-600 font-bold">REGISTERY</h2>
    <div class="mb-4">
      <label for="inputEmailConfirmationCode" id="inputEmailConfirmationCodeLabel" class="block text-gray-600 text-sm font-bold mb-1">Email confirmation:</label>
      <input type="text" id="inputEmailConfirmationCode" name="inputEmailConfirmationCode" class="bg-white rounded-lg w-full py-1.5 px-2 text-gray-700 shadow-md focus:outline-none focus:ring focus:ring-gray-200 focus:bg-gray-200" required>
      <label id="emailConfirmationNotification" class="text-xs font-semibold text-center text-green-400 hidden">A verification code has been sent to the email you entered. Write it in the box above and verify..</label> 
    </div>
    <button type="submit" id="confirmEmailForm2" class="bg-yellow-300 hover:bg-yellow-400 text-white font-semibold py-2 px-4 rounded-lg focus:outline-none w-full text-shadow">
      Confirm Email
    </button>
  </form>
    <div id="successMessage" class="hidden mt-4 text-green-500 font-semibold text-center">Registration successful!</div>
    <div id="wrongMessage" class="hidden mt-4 text-red-500 font-semibold text-center">Registration failed!</div>
    <button type="button" id="tryAgainForRegistery" class="bg-yellow-300 hover:bg-yellow-400 text-white font-semibold py-2 px-4 rounded-lg focus:outline-none w-full text-shadow hidden">
      Try Again
    </button>
    <button type="button" id="redirectToLogin" class="mt-4 bg-yellow-300 hover:bg-yellow-400 text-white font-semibold py-2 px-4 rounded-lg focus:outline-none w-full text-shadow hidden">
      Redirect To Login
    </button>
  </div>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
        const passwordTooltip = document.getElementById('passwordTooltip');
        const passwordInput = document.getElementById('password');
        const confirmPasswordInput = document.getElementById('confirmPassword');
        const registerForm = document.getElementById('registerForm');
        const registerForm2 = document.getElementById('registerForm2');
        const nameToolTip = document.getElementById('nameToolTip');
        const lastNameToolTip = document.getElementById('lastNameToolTip');
        const confirmPasswordTooltip = document.getElementById('confirmPasswordTooltip');
        const birthdateToolTip = document.getElementById('birthdateToolTip');
        const wrongMessage = document.getElementById('wrongMessage');

        passwordInput.addEventListener('input', function() {
            const password = passwordInput.value;

            const hasNumber = /\d/.test(password);
            const hasLetter = /[a-zA-Z]/.test(password);
            const hasSymbol = /[!@#$%^&*]/.test(password);
            const hasNoSpaces = !/\s/.test(password);
            const isLongEnough = password.length >= 6;

            if (hasNumber && hasLetter && hasSymbol && hasNoSpaces && isLongEnough) {
                confirmPasswordInput.disabled = false; 
                passwordTooltip.classList.add('hidden');
            } else {
                confirmPasswordInput.disabled = true;
                confirmPasswordInput.value = '';
                passwordTooltip.classList.remove('hidden');
            }
        });

        confirmPasswordInput.addEventListener('input', function() {
          const password = passwordInput.value;
          const confirmPassword = confirmPasswordInput.value;

          if (password === confirmPassword) {
            confirmPasswordTooltip.classList.add('hidden');
          } else {
            confirmPasswordTooltip.classList.remove('hidden');
          }
        });

        registerForm.addEventListener('submit', async function(event) {
    event.preventDefault();

    const birthdate = new Date(document.getElementById('birthdate').value);
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    const confirmPassword = document.getElementById('confirmPassword').value;

    const age = new Date().getFullYear() - birthdate.getFullYear();
    const monthDiff = new Date().getMonth() - birthdate.getMonth();
    const isUnder18 = age < 18 || (age === 18 && monthDiff < 0);
    const passwordIsValid = (password === confirmPassword) &&
                             /^[A-Za-z0-9!@#$%^&*]{6,}$/.test(password) &&
                             /\d/.test(password) &&
                             /[A-Za-z]/.test(password) &&
                             /[!@#$%^&*]/.test(password) &&
                             !/\s/.test(password);

    birthdateToolTip.classList.toggle('hidden', isUnder18);
    confirmPasswordTooltip.classList.toggle('hidden', passwordIsValid);

    if (passwordIsValid) {
      try {
        const response = await fetch('/send-confirmation-code', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ email })
        });
        if (!response.ok) {
            throw new Error('Bir hata oluştu');
        }
        const result = await response.json();
        if (result === true) {
          document.getElementById('emailConfirmationNotification').classList.remove('hidden');
          registerForm.classList.add('hidden');
          registerForm2.classList.remove('hidden');
        } else {
          throw new Error('Confirmation code could not be sent.');
        }
    } catch (error) {
        console.error('Hata:', error);
    }
    } else {
        registerForm.classList.remove('hidden');
        registerForm2.classList.add('hidden');
    }
});

async function sendConfirmationCode(email) { 
    try {
        const response = await fetch('/send-confirmation-code', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ email })
        });
        if (!response.ok) {
            throw new Error('Bir hata oluştu');
        }
        document.getElementById('emailConfirmationNotification').classList.remove('hidden');
    } catch (error) {
        console.error('Hata:', error);
    }
}

registerForm2.addEventListener('submit', async function(event) {
    event.preventDefault();

    const successfulRegistration = document.getElementById('successMessage');
    const tryAgainForRegistery = document.getElementById('tryAgainForRegistery');
    const failRegistery = document.getElementById('wrongMessage');
    const name = document.getElementById('firstName').value;
    const lastName = document.getElementById('lastName').value;
    const birthday = document.getElementById('birthdate').value;
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    const userCode = document.getElementById('inputEmailConfirmationCode').value;

    failRegistery.classList.add('hidden');
    successfulRegistration.classList.add('hidden');

    try {
        const response = await fetch('/verification-code-confirmation', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                name,
                lastName,
                birthday,
                email,
                password,
                userCode
            })
        });

        //bakalım bunu görücek misin zeninle zaman geçirmeyi sevmeye başlayalı uzun zaman oldu

        const result = await response.json();

        if (result) {
            document.getElementById('emailConfirmationNotification').classList.add('hidden');
            document.getElementById('inputEmailConfirmationCode').classList.add('hidden');
            document.getElementById('tryAgainForRegistery').classList.add('hidden');
            document.getElementById('inputEmailConfirmationCodeLabel').classList.add('hidden');
            document.getElementById('confirmEmailForm2').classList.add('hidden');
            document.getElementById('redirectToLogin').classList.remove('hidden');

            successfulRegistration.classList.remove('hidden');
            failRegistery.classList.add('hidden');
        } else {
            registerForm2.classList.add('hidden');
            failRegistery.classList.remove('hidden');
            successfulRegistration.classList.add('hidden');
            tryAgainForRegistery.classList.remove('hidden');
        }
    } catch (error) {
        console.error('Hata:', error);
    }
});
});
document.getElementById('tryAgainForRegistery').addEventListener('click',function(){
  window.location.href = '/registery';
});
document.getElementById('redirectToLogin').addEventListener('click',function(){
  window.location.href = '/login';
});
  </script>
</body>
</html>